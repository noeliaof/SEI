<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Calculate standardised indices — std_index • SEI</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Calculate standardised indices — std_index"><meta name="description" content="Inputs a time series of a chosen variable (e.g. precipitation,
energy demand, residual load etc.) and returns a time series of standardised indices.
Indices can be calculated on any timescale."><meta property="og:description" content="Inputs a time series of a chosen variable (e.g. precipitation,
energy demand, residual load etc.) and returns a time series of standardised indices.
Indices can be calculated on any timescale."></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">SEI</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.1</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="external-link dropdown-item" href="https://doi.org/10.31223/X5GM4G">Standardised Indices-SEI</a></li>
    <li><a class="external-link dropdown-item" href="https://doi.org/10.1016/j.renene.2023.119206">Energy droughts</a></li>
  </ul></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><a class="external-link nav-link" href="https://github.com/noeliaof/SEI"><span class="fa fab fa-github"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Calculate standardised indices</h1>
      <small class="dont-index">Source: <a href="https://github.com/noeliaof/SEI/blob/main/R/std_index.R" class="external-link"><code>R/std_index.R</code></a></small>
      <div class="d-none name"><code>std_index.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Inputs a time series of a chosen variable (e.g. precipitation,
energy demand, residual load etc.) and returns a time series of standardised indices.
Indices can be calculated on any timescale.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">std_index</span><span class="op">(</span></span>
<span>  <span class="va">x_new</span>,</span>
<span>  x_ref <span class="op">=</span> <span class="va">x_new</span>,</span>
<span>  timescale <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  dist <span class="op">=</span> <span class="st">"empirical"</span>,</span>
<span>  method <span class="op">=</span> <span class="st">"mle"</span>,</span>
<span>  return_fit <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  index_type <span class="op">=</span> <span class="st">"normal"</span>,</span>
<span>  preds_new <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  preds_ref <span class="op">=</span> <span class="va">preds_new</span>,</span>
<span>  gr_new <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  gr_ref <span class="op">=</span> <span class="va">gr_new</span>,</span>
<span>  moving_window <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  window_scale <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  agg_period <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  agg_scale <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  agg_fun <span class="op">=</span> <span class="st">"sum"</span>,</span>
<span>  rescale <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  rescale_fun <span class="op">=</span> <span class="st">"sum"</span>,</span>
<span>  ignore_na <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  n_thres <span class="op">=</span> <span class="fl">20</span>,</span>
<span>  na_thres <span class="op">=</span> <span class="fl">10</span>,</span>
<span>  lower <span class="op">=</span> <span class="op">-</span><span class="cn">Inf</span>,</span>
<span>  upper <span class="op">=</span> <span class="cn">Inf</span>,</span>
<span>  cens <span class="op">=</span> <span class="va">index_type</span>,</span>
<span>  <span class="va">...</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-x-new">x_new<a class="anchor" aria-label="anchor" href="#arg-x-new"></a></dt>
<dd><p>vector or time series to be converted to standardised indices.</p></dd>


<dt id="arg-x-ref">x_ref<a class="anchor" aria-label="anchor" href="#arg-x-ref"></a></dt>
<dd><p>vector or time series containing reference data to use when calculating the standardised indices.</p></dd>


<dt id="arg-timescale">timescale<a class="anchor" aria-label="anchor" href="#arg-timescale"></a></dt>
<dd><p>timescale of the data; <code>'mins'</code>, <code>'hours'</code>, <code>'days'</code>, <code>'weeks'</code>, <code>'months'</code>, <code>'years'</code>.</p></dd>


<dt id="arg-dist">dist<a class="anchor" aria-label="anchor" href="#arg-dist"></a></dt>
<dd><p>character string specifying the distribution to be fit to the data;
one of <code>'empirical'</code>, <code>'kde'</code>, <code>'norm'</code>, <code>'lnorm'</code>, <code>'logis'</code>, <code>'llogis'</code>,
<code>'exp'</code>, <code>'gamma'</code>, and <code>'weibull'</code>.</p></dd>


<dt id="arg-method">method<a class="anchor" aria-label="anchor" href="#arg-method"></a></dt>
<dd><p>A character string coding for the fitting method:
    <code>"mle"</code> for 'maximum likelihood estimation', <code>"mme"</code> for 'moment matching estimation',
    <code>"qme"</code> for 'quantile matching estimation', <code>"mge"</code> for 'maximum goodness-of-fit estimation'
    and <code>"mse"</code> for 'maximum spacing estimation'.</p></dd>


<dt id="arg-return-fit">return_fit<a class="anchor" aria-label="anchor" href="#arg-return-fit"></a></dt>
<dd><p>logical specifying whether to return parameters and goodness-of-fit
statistics for the distribution fit.</p></dd>


<dt id="arg-index-type">index_type<a class="anchor" aria-label="anchor" href="#arg-index-type"></a></dt>
<dd><p>the type of standardised index: <code>"normal"</code> (default), <code>"prob01"</code>,
or <code>"prob11"</code> (see details).</p></dd>


<dt id="arg-gr-new">gr_new<a class="anchor" aria-label="anchor" href="#arg-gr-new"></a></dt>
<dd><p>vector of factors for which separate distributions should be applied to <code>x_new</code>.</p></dd>


<dt id="arg-gr-ref">gr_ref<a class="anchor" aria-label="anchor" href="#arg-gr-ref"></a></dt>
<dd><p>vector of factors for which separate distributions should be fit to <code>x_ref</code>.</p></dd>


<dt id="arg-moving-window">moving_window<a class="anchor" aria-label="anchor" href="#arg-moving-window"></a></dt>
<dd><p>length of moving window on which to calculate the indices.</p></dd>


<dt id="arg-window-scale">window_scale<a class="anchor" aria-label="anchor" href="#arg-window-scale"></a></dt>
<dd><p>timescale of <code>moving_window</code>; default is the timescale of the data.</p></dd>


<dt id="arg-agg-period">agg_period<a class="anchor" aria-label="anchor" href="#arg-agg-period"></a></dt>
<dd><p>length of the aggregation period.</p></dd>


<dt id="arg-agg-scale">agg_scale<a class="anchor" aria-label="anchor" href="#arg-agg-scale"></a></dt>
<dd><p>timescale of <code>agg_period</code>;
one of <code>'mins'</code>, <code>'hours'</code>, <code>'days'</code>, <code>'weeks'</code>, <code>'months'</code>, <code>'years'</code>.</p></dd>


<dt id="arg-agg-fun">agg_fun<a class="anchor" aria-label="anchor" href="#arg-agg-fun"></a></dt>
<dd><p>string specifying the function used to aggregate the data over the
aggregation period, default is <code>'sum'</code>.</p></dd>


<dt id="arg-rescale">rescale<a class="anchor" aria-label="anchor" href="#arg-rescale"></a></dt>
<dd><p>the timescale that the time series should be rescaled to;
one of <code>"days"</code>, <code>"weeks"</code>, <code>"months"</code>, <code>"quarters"</code>, and <code>"years"</code>.</p></dd>


<dt id="arg-rescale-fun">rescale_fun<a class="anchor" aria-label="anchor" href="#arg-rescale-fun"></a></dt>
<dd><p>string specifying the function used to rescale the data; default is <code>"sum"</code>.</p></dd>


<dt id="arg-ignore-na">ignore_na<a class="anchor" aria-label="anchor" href="#arg-ignore-na"></a></dt>
<dd><p>logical specifying whether to ignore NAs when rescaling the time series.</p></dd>


<dt id="arg-n-thres">n_thres<a class="anchor" aria-label="anchor" href="#arg-n-thres"></a></dt>
<dd><p>minimum number of data points required to estimate the distribution;
default is 20.</p></dd>


<dt id="arg-na-thres">na_thres<a class="anchor" aria-label="anchor" href="#arg-na-thres"></a></dt>
<dd><p>threshold for the percentage of NA values allowed in the
aggregation period; default is 10.</p></dd>


<dt id="arg-lower-upper">lower, upper<a class="anchor" aria-label="anchor" href="#arg-lower-upper"></a></dt>
<dd><p>numeric values specifying the lower and upper bounds at which censoring
is to be performed.</p></dd>


<dt id="arg-cens">cens<a class="anchor" aria-label="anchor" href="#arg-cens"></a></dt>
<dd><p>values to assign to censored values; either a string (<code>'normal'</code> or <code>'prob'</code>),
corresponding to common choices, or a custom numeric vector of length two.</p></dd>


<dt id="arg--">...<a class="anchor" aria-label="anchor" href="#arg--"></a></dt>
<dd><p>additional arguments to be passed to <code><a href="https://lbbe-software.github.io/fitdistrplus/reference/fitdist.html" class="external-link">fitdistrplus::fitdist</a></code></p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>Time series of standardised indices.</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>Standardised indices are calculated by estimating the cumulative distribution function (CDF)
of the variable of interest, and using this to transform the measurements to
a standardised scale.</p>
<p><code>std_index()</code> estimates the CDF using a time series of reference data <code>x_ref</code>,
and applies the resulting transformation to the time series <code>x_new</code>. The result is
a time series of standardised <code>x_new</code> values. These standardised indices quantify
how extreme the <code>x_new</code> values are in reference to <code>x_ref</code>.
<code>x_new</code> and <code>x_ref</code> should therefore contain values of the same variable.
If <code>x_ref</code> is not specified, then <code>x_new</code> is also used to estimate the CDF.</p>
<p><code>x_new</code> and <code>x_ref</code> can either be provided as vectors or xts time series.
In the latter case, the time series can be aggregated across timescales or rescaled.
This is useful, for example, if <code>x_new</code> contains hourly data, but interest is
on daily accumulations or averages of the hourly data.</p>
<p>The argument <code>rescale</code> converts the data to a different timescale. The original
timescale of the data can be manually specified using the argument <code>timescale</code>.
<code>timescale</code> is required if the time series is to be aggregated or rescaled.
Otherwise, the function will try to automatically determine the timescale of the data.
Manually specifying the timescale of the data is generally more robust. The rescaling
is performed using the function <code>rescale_fun</code>. By default, this is assumed to be
<code>rescale_fun = "sum"</code>, so that values are added across the timescale of interest.
This can be changed to any user-specified function.</p>
<p>The argument <code>agg_period</code> aggregates the data across the timescale of interest.
This differs from <code>rescale</code> in that the resolution of the data remains the same.
<code>agg_period</code> is a number specifying how long the data should be aggregated across.
By default, it is assumed that <code>agg_period</code> is on the same timescale as <code>x_new</code>
and <code>x_ref</code>. For example, if the data is hourly and <code>agg_period = 24</code>, then
this assumes the data is to be aggregated over the past 24 hours. The scale of the
aggregation period can also be specified manually using <code>agg_scale</code>. For example,
one could also specify <code>agg_period = 1</code> and <code>agg_scale = "days"</code>, and this
would also aggregate the data over the past day. <code>agg_fun</code> specifies how the
data is to be aggregated, the default is <code>agg_fun = "sum"</code>.</p>
<p><code>dist</code> is the distribution used to estimate the CDF from <code>x_ref</code>.
Currently, functionality is available to fit one of the following distributions to the data:
Normal ('norm'), Log-normal ('lnorm'), Logistic ('logis'), Log-logistic ('llogis'),
Exponential ('exp'), Gamma ('gamma'), and Weibull ('weibull').
Alternatively, the CDF can be estimated empirically (<code>dist = "empirical"</code>)
based on the values in <code>x_ref</code>, or using kernel density estimation (<code>dist = "kde"</code>).</p>
<p>If <code>dist</code> is a parametric family of distributions, then parameters of the
distribution are estimated using maximum likelihood estimation from <code>x_ref</code>.
The resulting parameters and corresponding goodness-of-fit statistics can be
returned by specifying <code>return_fit = TRUE</code>.</p>
<p>By default, the distribution is estimated over all values in <code>x_ref</code>. Alternatively,
if <code>x_new</code> is an xts object, parameters can be estimated sequentially using a
moving window of values. <code>moving_window</code> determines the length of the moving window.
This is a single value, assumed to be on the same timescale as <code>x_new</code>.
This can also be specified manually using <code>window_scale</code>. <code>window_scale</code>
must also be one of "days", "weeks", "months", "quarters", and "years".</p>
<p>The function returns a vector of time series (depending on the format of <code>x_new</code>)
containing the standardised indices corresponding to <code>x_new</code>. Three different
types of indices are available, which are explained in detail in the vignette.
The index type can be chosen using <code>index_type</code>, which must be one of
"normal" (default), "prob01", and "prob11".</p>
    </div>
    <div class="section level2">
    <h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a></h2>
    <p>Allen, S. and N. Otero (2023):
`Standardised indices to monitor energy droughts',
<em>Renewable Energy</em> 217, 119206
<a href="https://doi.org/10.1016/j.renene.2023.119206" class="external-link">doi:10.1016/j.renene.2023.119206</a></p>
<p>McKee, T. B., Doesken, N. J., &amp; Kleist, J. (1993):
`The relationship of drought frequency and duration to time scales',
<em>In Proceedings of the 8th Conference on Applied Climatology</em> 17, 179-183.</p>
    </div>
    <div class="section level2">
    <h2 id="author">Author<a class="anchor" aria-label="anchor" href="#author"></a></h2>
    <p>Sam Allen, Noelia Otero</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">data_supply</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co"># consider hourly German energy supply data in 2019</span></span></span>
<span class="r-in"><span><span class="va">supply_de</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">data_supply</span>, <span class="va">country</span> <span class="op">==</span> <span class="st">"Germany"</span>, select <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"date"</span>, <span class="st">"PWS"</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">supply_de</span> <span class="op">&lt;-</span> <span class="fu">xts</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/xts/man/xts.html" class="external-link">xts</a></span><span class="op">(</span><span class="va">supply_de</span><span class="op">$</span><span class="va">PWS</span>, order.by <span class="op">=</span> <span class="va">supply_de</span><span class="op">$</span><span class="va">date</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co">#options(xts_check_TZ = FALSE)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># convert to hourly standardised indices</span></span></span>
<span class="r-in"><span><span class="va">supply_de_std</span> <span class="op">&lt;-</span> <span class="fu">std_index</span><span class="op">(</span><span class="va">supply_de</span>, timescale <span class="op">=</span> <span class="st">"hours"</span><span class="op">)</span></span></span>
<span class="r-err co"><span class="r-pr">#&gt;</span> <span class="error">Error in std_index(supply_de, timescale = "hours"):</span> object 'preds' not found</span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/hist.html" class="external-link">hist</a></span><span class="op">(</span><span class="va">supply_de</span>, main <span class="op">=</span> <span class="st">"Raw values"</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="std_index-1.png" alt="" width="700" height="433"></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/hist.html" class="external-link">hist</a></span><span class="op">(</span><span class="va">supply_de_std</span>, main <span class="op">=</span> <span class="st">"Standardised values"</span><span class="op">)</span></span></span>
<span class="r-err co"><span class="r-pr">#&gt;</span> <span class="error">Error in eval(expr, envir, enclos):</span> object 'supply_de_std' not found</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># convert to daily or weekly standardised indices</span></span></span>
<span class="r-in"><span><span class="va">supply_de_std</span> <span class="op">&lt;-</span> <span class="fu">std_index</span><span class="op">(</span><span class="va">supply_de</span>, timescale <span class="op">=</span> <span class="st">"hours"</span>, rescale <span class="op">=</span> <span class="st">"days"</span><span class="op">)</span></span></span>
<span class="r-err co"><span class="r-pr">#&gt;</span> <span class="error">Error in std_index(supply_de, timescale = "hours", rescale = "days"):</span> object 'preds' not found</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># convert to weekly standardised indices calculated on each day</span></span></span>
<span class="r-in"><span><span class="va">supply_de_std</span> <span class="op">&lt;-</span> <span class="fu">std_index</span><span class="op">(</span><span class="va">supply_de</span>, timescale <span class="op">=</span> <span class="st">"hours"</span>, rescale <span class="op">=</span> <span class="st">"days"</span>,</span></span>
<span class="r-in"><span>                           agg_period <span class="op">=</span> <span class="fl">1</span>, agg_scale <span class="op">=</span> <span class="st">"weeks"</span><span class="op">)</span></span></span>
<span class="r-err co"><span class="r-pr">#&gt;</span> <span class="error">Error in aggregate_xts(x_new, len = agg_period, scale = agg_scale, fun = agg_fun,     timescale = timescale, na_thres = na_thres):</span> unused arguments (len = agg_period, scale = agg_scale, fun = agg_fun)</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># calculate standardised indices corresponding to December, based on the previous year</span></span></span>
<span class="r-in"><span><span class="va">dec</span> <span class="op">&lt;-</span> <span class="fu">zoo</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/zoo/man/index.html" class="external-link">index</a></span><span class="op">(</span><span class="va">supply_de</span><span class="op">)</span> <span class="op">&gt;</span> <span class="st">"2019-12-01 UTC"</span></span></span>
<span class="r-in"><span><span class="va">supply_de_std_dec</span> <span class="op">&lt;-</span> <span class="fu">std_index</span><span class="op">(</span>x_new <span class="op">=</span> <span class="va">supply_de</span><span class="op">[</span><span class="va">dec</span><span class="op">]</span>, x_ref <span class="op">=</span> <span class="va">supply_de</span><span class="op">[</span><span class="op">!</span><span class="va">dec</span><span class="op">]</span>,</span></span>
<span class="r-in"><span>                               timescale <span class="op">=</span> <span class="st">"hours"</span><span class="op">)</span></span></span>
<span class="r-err co"><span class="r-pr">#&gt;</span> <span class="error">Error in std_index(x_new = supply_de[dec], x_ref = supply_de[!dec], timescale = "hours"):</span> object 'preds' not found</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># calculate standardised indices using a 100 day moving window</span></span></span>
<span class="r-in"><span><span class="va">supply_de_std_dec</span> <span class="op">&lt;-</span> <span class="fu">std_index</span><span class="op">(</span><span class="va">supply_de</span><span class="op">[</span><span class="va">dec</span><span class="op">]</span>, <span class="va">supply_de</span>, timescale <span class="op">=</span> <span class="st">"hours"</span>,</span></span>
<span class="r-in"><span>                               rescale <span class="op">=</span> <span class="st">"days"</span>, moving_window <span class="op">=</span> <span class="fl">100</span><span class="op">)</span></span></span>
<span class="r-err co"><span class="r-pr">#&gt;</span> <span class="error">Error in std_index(supply_de[dec], supply_de, timescale = "hours", rescale = "days",     moving_window = 100):</span> object 'preds' not found</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># suppose we are interested in the daily maximum rather than the daily total</span></span></span>
<span class="r-in"><span><span class="va">supply_de_std</span> <span class="op">&lt;-</span> <span class="fu">std_index</span><span class="op">(</span><span class="va">supply_de</span>, timescale <span class="op">=</span> <span class="st">"hours"</span>, rescale <span class="op">=</span> <span class="st">"days"</span>,</span></span>
<span class="r-in"><span>                           rescale_fun <span class="op">=</span> <span class="st">"max"</span><span class="op">)</span></span></span>
<span class="r-err co"><span class="r-pr">#&gt;</span> <span class="error">Error in std_index(supply_de, timescale = "hours", rescale = "days", rescale_fun = "max"):</span> object 'preds' not found</span>
<span class="r-in"><span><span class="va">supply_de_std</span> <span class="op">&lt;-</span> <span class="fu">std_index</span><span class="op">(</span><span class="va">supply_de</span>, timescale <span class="op">=</span> <span class="st">"hours"</span>, rescale <span class="op">=</span> <span class="st">"days"</span>,</span></span>
<span class="r-in"><span>                           rescale_fun <span class="op">=</span> <span class="st">"mean"</span><span class="op">)</span> <span class="co"># or average</span></span></span>
<span class="r-err co"><span class="r-pr">#&gt;</span> <span class="error">Error in std_index(supply_de, timescale = "hours", rescale = "days", rescale_fun = "mean"):</span> object 'preds' not found</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># the default uses the empirical distribution, but this requires more data than</span></span></span>
<span class="r-in"><span><span class="co"># parametric distributions, meaning it is not ideal when data is short, e.g. in weekly case</span></span></span>
<span class="r-in"><span><span class="va">supply_de_std</span> <span class="op">&lt;-</span> <span class="fu">std_index</span><span class="op">(</span><span class="va">supply_de</span>, timescale <span class="op">=</span> <span class="st">"hours"</span>, rescale <span class="op">=</span> <span class="st">"weeks"</span><span class="op">)</span> <span class="co"># warning</span></span></span>
<span class="r-err co"><span class="r-pr">#&gt;</span> <span class="error">Error in std_index(supply_de, timescale = "hours", rescale = "weeks"):</span> object 'preds' not found</span>
<span class="r-in"><span><span class="co"># instead, we can use a parametric distribution, e.g. a gamma distribution</span></span></span>
<span class="r-in"><span><span class="va">supply_de_std</span> <span class="op">&lt;-</span> <span class="fu">std_index</span><span class="op">(</span><span class="va">supply_de</span>, timescale <span class="op">=</span> <span class="st">"hours"</span>, rescale <span class="op">=</span> <span class="st">"weeks"</span>, dist <span class="op">=</span> <span class="st">"gamma"</span><span class="op">)</span></span></span>
<span class="r-err co"><span class="r-pr">#&gt;</span> <span class="error">Error in std_index(supply_de, timescale = "hours", rescale = "weeks",     dist = "gamma"):</span> object 'preds' not found</span>
<span class="r-in"><span><span class="co"># we can check the fit by checking whether the indices resemble a standard normal distribution</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/hist.html" class="external-link">hist</a></span><span class="op">(</span><span class="va">supply_de</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="std_index-2.png" alt="" width="700" height="433"></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/hist.html" class="external-link">hist</a></span><span class="op">(</span><span class="va">supply_de_std</span><span class="op">)</span></span></span>
<span class="r-err co"><span class="r-pr">#&gt;</span> <span class="error">Error in eval(expr, envir, enclos):</span> object 'supply_de_std' not found</span>
<span class="r-in"><span><span class="co"># we can also look at the properties of the fit</span></span></span>
<span class="r-in"><span><span class="va">supply_de_std</span> <span class="op">&lt;-</span> <span class="fu">std_index</span><span class="op">(</span><span class="va">supply_de</span>, timescale <span class="op">=</span> <span class="st">"hours"</span>, rescale <span class="op">=</span> <span class="st">"weeks"</span>,</span></span>
<span class="r-in"><span>                           dist <span class="op">=</span> <span class="st">"gamma"</span>, return_fit <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-err co"><span class="r-pr">#&gt;</span> <span class="error">Error in std_index(supply_de, timescale = "hours", rescale = "weeks",     dist = "gamma", return_fit = TRUE):</span> object 'preds' not found</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># we could also use kernel density estimation, which is a flexible compromise between the two</span></span></span>
<span class="r-in"><span><span class="va">supply_de_std</span> <span class="op">&lt;-</span> <span class="fu">std_index</span><span class="op">(</span><span class="va">supply_de</span>, timescale <span class="op">=</span> <span class="st">"hours"</span>, rescale <span class="op">=</span> <span class="st">"weeks"</span>, dist <span class="op">=</span> <span class="st">"kde"</span><span class="op">)</span></span></span>
<span class="r-err co"><span class="r-pr">#&gt;</span> <span class="error">Error in std_index(supply_de, timescale = "hours", rescale = "weeks",     dist = "kde"):</span> object 'preds' not found</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># calculate separate indices for each quarter of 2019</span></span></span>
<span class="r-in"><span><span class="va">season</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">ceiling</a></span><span class="op">(</span><span class="fu">lubridate</span><span class="fu">::</span><span class="fu"><a href="https://lubridate.tidyverse.org/reference/month.html" class="external-link">month</a></span><span class="op">(</span><span class="fu">zoo</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/zoo/man/index.html" class="external-link">index</a></span><span class="op">(</span><span class="va">supply_de</span><span class="op">)</span><span class="op">)</span> <span class="op">/</span> <span class="fl">3</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">season</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Q1"</span>, <span class="st">"Q2"</span>, <span class="st">"Q3"</span>, <span class="st">"Q4"</span><span class="op">)</span><span class="op">[</span><span class="va">season</span><span class="op">]</span></span></span>
<span class="r-in"><span><span class="va">supply_de_std</span> <span class="op">&lt;-</span> <span class="fu">std_index</span><span class="op">(</span><span class="va">supply_de</span>, timescale <span class="op">=</span> <span class="st">"hours"</span>, rescale <span class="op">=</span> <span class="st">"days"</span>,</span></span>
<span class="r-in"><span>                           gr_new <span class="op">=</span> <span class="va">season</span>, dist <span class="op">=</span> <span class="st">"kde"</span>, return_fit <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-err co"><span class="r-pr">#&gt;</span> <span class="error">Error in std_index(x_new[ind], x_ref[ind], timescale = timescale, dist = dist,     return_fit = return_fit, index_type = index_type, agg_period = agg_period,     agg_scale = agg_scale, agg_fun = agg_fun, rescale = rescale,     ignore_na = ignore_na, na_thres = na_thres, lower = lower,     upper = upper, cens = cens):</span> object 'preds' not found</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Sam Allen, Noelia Otero.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.0.</p>
</div>

    </footer></div>





  </body></html>

